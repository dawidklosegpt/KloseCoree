<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KloseCore â€” Dawid Klose 2025</title>
<style>
  /* --- TwÃ³j oryginalny styl --- */
  :root{
    --bg:#0f1113; --panel:#151617; --muted:#9aa0a6; --accent:#5eead4;
    --user:#1f2937; --ai:#111827; --glass: rgba(255,255,255,0.03);
  }
  .light {
    --bg:#f6f7fb; --panel:#ffffff; --muted:#6b7280; --accent:#0ea5a4;
    --user:#e6eef3; --ai:#f3f4f6; --glass: rgba(0,0,0,0.03);
  }

  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
  body{
    background: radial-gradient(1200px 600px at 10% 10%, rgba(94,234,212,0.04), transparent 10%),
                radial-gradient(900px 500px at 90% 90%, rgba(99,102,241,0.03), transparent 10%),
                var(--bg);
    color: #e6eef3;
    transition: background 500ms ease, color 300ms ease;
    display:flex; height:100vh; gap:16px; padding:16px;
  }

  .sidebar{
    width:260px; background:linear-gradient(180deg,var(--panel), rgba(255,255,255,0.01));
    border-radius:14px; padding:14px; display:flex; flex-direction:column; gap:12px;
    box-shadow: 0 6px 30px rgba(2,6,23,0.6);
  }
  .sidebar h3{margin:4px 0 8px 0; font-size:14px; color:var(--muted)}
  #history{display:flex; flex-direction:column; gap:8px; overflow:auto; max-height:60vh; padding-right:6px}
  .history-item{background:var(--glass); padding:8px 10px; border-radius:8px; font-size:13px; color:var(--muted); cursor:pointer; transition: transform 180ms ease, box-shadow 180ms ease;}
  .history-item:hover{ transform: translateX(6px); box-shadow: 0 6px 18px rgba(0,0,0,0.3)}

  .controls{display:flex; gap:8px; align-items:center}
  .btn {padding:8px 10px; border-radius:10px; border:none; cursor:pointer; background:rgba(255,255,255,0.02); color:var(--muted); transition: transform 160ms ease, background 160ms}
  .btn:active{transform: translateY(1px)}
  .theme-toggle{display:flex; align-items:center; gap:8px; padding:6px 8px; border-radius:12px; background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent)}
  .brand{font-weight:600; font-size:14px; color:var(--muted); margin-top:auto; text-align:center}

  .main{flex:1; display:flex; flex-direction:column; gap:12px;}
  .chat-panel{background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent 40%); border-radius:14px; padding:16px; display:flex; flex-direction:column; height:calc(100vh - 120px); box-shadow: 0 8px 40px rgba(2,6,23,0.6);}
  .messages{flex:1; overflow:auto; display:flex; flex-direction:column; gap:12px; padding-right:8px}
  .msg-row{display:flex; gap:10px; align-items:flex-end; max-width:80%}
  .msg-user{margin-left:auto; justify-content:flex-end}
  .bubble{padding:12px 14px; border-radius:14px; position:relative; line-height:1.3; white-space:pre-wrap; box-shadow: 0 6px 20px rgba(2,6,23,0.45);}
  .bubble.ai{background: linear-gradient(180deg,var(--ai), rgba(255,255,255,0.02)); color: #e6eef3; border-top-left-radius:6px;}
  .bubble.user{background: linear-gradient(180deg,var(--user), rgba(255,255,255,0.01)); color:#fff; border-top-right-radius:6px;}

  @keyframes popIn {0% { transform: translateY(12px) scale(.98); opacity:0 }60% { transform: translateY(-6px) scale(1.02); opacity:1 }100% { transform: translateY(0) scale(1) }}
  .bubble.animated { animation: popIn 420ms cubic-bezier(.2,.9,.2,1) both; }

  .thinking {display:inline-flex; gap:6px; padding:8px 6px;}
  .dot{width:8px; height:8px; background:var(--muted); border-radius:50%; opacity:0.9; transform: translateY(0); animation: bounce 800ms infinite alternate;}
  .dot:nth-child(2){ animation-delay:160ms }
  .dot:nth-child(3){ animation-delay:320ms }
  @keyframes bounce { 0%{transform:translateY(0)} 100%{transform:translateY(-6px)} }

  .input-area{display:flex; gap:10px; align-items:center; padding-top:12px}
  .text-input{flex:1; padding:12px 14px; border-radius:12px; border:none; outline:none; background:var(--glass); color:inherit; box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);}
  .text-input:focus{ box-shadow: 0 6px 26px rgba(2,6,23,0.6);}
  .icon-btn{width:48px; height:48px; border-radius:12px; display:grid; place-items:center; cursor:pointer; border:none; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent)}
  .icon-btn.recording{ box-shadow: 0 0 0 6px rgba(245,34,45,0.08); animation: pulse 1200ms infinite;}
  @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.04)} 100%{transform:scale(1)} }

  .footer { text-align:center; color:var(--muted); font-size:12px; margin-top:8px }
</style>
</head>
<body>
  <div class="sidebar">
    <h3>Historia czatu</h3>
    <div id="history"></div>
    <div class="controls">
      <div class="theme-toggle btn" id="themeBtn"><span id="themeIcon">ðŸŒ™</span></div>
      <button class="btn" id="clearHistory">WyczyÅ›Ä‡</button>
    </div>
    <div class="brand">Â© 2025 Dawid Klose â€” KloseCore</div>
  </div>

  <div class="main">
    <div class="chat-panel">
      <div class="messages" id="messages"></div>
      <div class="input-area">
        <input id="userInput" class="text-input" placeholder="Napisz wiadomoÅ›Ä‡..." autocomplete="off" />
        <button id="recordBtn" class="icon-btn">ðŸŽ¤</button>
        <button id="sendBtn" class="icon-btn">âž¤</button>
      </div>
    </div>
    <div class="footer">Witaj â€” jestem asystentem AI stworzonym przez Dawida Klose w 2025 roku.</div>
  </div>

<script>
const API_BASE = "https://klosecore.onrender.com";
const messagesEl = document.getElementById('messages');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const recordBtn = document.getElementById('recordBtn');
const historyEl = document.getElementById('history');
let isRecording = false, mediaRecorder, audioChunks = [];

function appendBubble(text, who='ai', animated=true){
  const row = document.createElement('div');
  row.className = 'msg-row ' + (who==='user' ? 'msg-user' : '');
  const bubble = document.createElement('div');
  bubble.className = `bubble ${who} ${animated ? 'animated' : ''}`;
  bubble.textContent = text;
  row.appendChild(bubble);
  messagesEl.appendChild(row);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

async function sendMessageFlow(text){
  if(!text.trim()) return;
  appendBubble(text, 'user');
  userInput.value = '';
  const thinking = document.createElement('div');
  thinking.className = 'bubble ai thinking';
  thinking.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
  messagesEl.appendChild(thinking);
  messagesEl.scrollTop = messagesEl.scrollHeight;
  try{
    const res = await fetch(`${API_BASE}/chat`, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({message:text})});
    const data = await res.json();
    thinking.remove();
    appendBubble(data.reply || "Brak odpowiedzi", 'ai');
  }catch(e){
    thinking.remove();
    appendBubble('âŒ BÅ‚Ä…d poÅ‚Ä…czenia z serwerem.', 'ai');
  }
}

sendBtn.onclick = ()=> sendMessageFlow(userInput.value);
userInput.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); sendMessageFlow(userInput.value); }});

recordBtn.onclick = async ()=>{
  if(isRecording){ mediaRecorder.stop(); return; }
  try{
    const stream = await navigator.mediaDevices.getUserMedia({audio:true});
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];
    mediaRecorder.ondataavailable = e=> audioChunks.push(e.data);
    mediaRecorder.onstop = async ()=>{
      appendBubble("ðŸŽ¤ [nagranie wysÅ‚ane]", "user");
      const res = await fetch(`${API_BASE}/voice_reply`, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({message:"WiadomoÅ›Ä‡ gÅ‚osowa"})});
      const data = await res.json();
      appendBubble(data.reply || "Brak odpowiedzi gÅ‚osowej", "ai");
      if(data.audio){ new Audio(data.audio).play(); }
    };
    mediaRecorder.start();
    isRecording = true;
    recordBtn.classList.add('recording');
    setTimeout(()=>{ mediaRecorder.stop(); isRecording=false; recordBtn.classList.remove('recording'); }, 4000);
  }catch(e){ alert("Brak dostÄ™pu do mikrofonu."); }
};

document.getElementById('clearHistory').onclick = ()=> historyEl.innerHTML='';
document.getElementById('themeBtn').onclick = ()=>{
  document.documentElement.classList.toggle('light');
  document.getElementById('themeIcon').textContent = document.documentElement.classList.contains('light') ? 'â˜€ï¸' : 'ðŸŒ™';
};

window.addEventListener('load', ()=>{
  appendBubble('ðŸ‘‹ Witaj! Jestem KloseCore â€” twÃ³j asystent AI.', 'ai');
});
</script>
</body>
</html>
